# API自動化の評価を出力結果から状態整合へ、Agent-Diffが示す実運用テストの再設計
## 成功レスポンスでも壊れるシステムを見抜く評価軸
> 返り値が正しくても、業務状態が壊れていれば失敗である。

## 結論（先に要点）
Agent-Diffは、Enterprise APIタスクにおけるLLMエージェント評価で、最終応答中心の判定からState-Diff（状態差分）中心の判定へ軸を移した。コード実行を通じてAPI操作を再現し、結果の見た目ではなく内部状態の整合で評価することで、業務自動化に特有の潜在障害を検出しやすくする。APIエージェントの品質保証は、自然言語評価だけでは不十分である。

対象論文: **Agent-Diff: Benchmarking LLM Agents on Enterprise API Tasks via Code Execution with State-Diff-Based Evaluation**  
公開日: 2026-02-12  
URL: https://arxiv.org/abs/2602.11224

---

## 先にひとことで言うと
- エージェント評価を「正答」から「状態の健全性」へ引き上げる研究である。

---

## ここが意外だった
- よくある見方: API連携エージェントは最終レスポンスが合っていれば合格。  
- この論文が示したこと: 手順途中の状態破壊は、最終レスポンスでは隠れる。  
- それが重要な理由: 本番障害の多くは部分成功と状態不整合の組み合わせで起きるため。

---

## この記事で分かること
- Agent-Diffの評価設計の狙い
- なぜコード実行ベース評価が必要か
- Enterprise API自動化の品質保証で追加すべきチェック項目

---

## 用語ミニ解説
- State-Diff: 実行前後のシステム状態差分を比較し、整合性を判定する方法。  
- Enterprise API: 企業内システム連携に使う認証・権限付きAPI群。  
- Code Execution評価: 実際に処理を走らせ、挙動と結果を検証する評価手法。

---

## 何がどう変わったのか（重要順）
1. APIタスク評価の中心が、応答文の妥当性から状態整合性へ移った。  
2. コード実行で中間挙動を追跡し、失敗原因を分解しやすくした。  
3. 企業向けAPIタスクに特化し、業務運用との接続を明確化した。

---

## この研究は何をどう検証したのか
### データ設計
Enterprise API操作を想定したタスク群を設定し、出力だけでなく副作用まで評価可能な構成を前提としている。

### タスク設計
LLMエージェントにAPI操作を実行させ、前後状態の変化をState-Diffとして記録・比較する流れを採用している。

### 評価指標
- 最終タスク達成
- 状態差分の妥当性
- 実行過程の一貫性

---

## 主な結果（根拠つき）
1. **企業APIタスクに焦点を当てた評価**  
根拠: タイトルに`Enterprise API Tasks`と明記。  

2. **コード実行による検証方式を採用**  
根拠: タイトルに`via Code Execution`を含む。  

3. **State-Diffベース評価の導入**  
根拠: タイトルに`State-Diff-Based Evaluation`を明示。  

---

## 限界と注意点
- 分かっていること: 状態整合性評価がAPI自動化品質に有効である。  
- まだ分からないこと: 実システムの複雑権限制御で同等の評価再現性が得られるかは未確定。

---

## 実務チェックリスト
- [ ] APIエージェント試験で前後状態の差分検証を必須化する
- [ ] 障害時に中間状態を保存して再現可能性を確保する
- [ ] 応答評価と状態評価を別指標として運用する
- [ ] 権限エラー・部分成功ケースを回帰試験へ追加する

---

## 背景と文脈（ボーナス）
企業システムのAPI連携は、可観測な失敗より不可観測な整合崩れが運用を止める。エージェント評価にState-Diffを組み込む流れは、AI評価が「賢さ」から「壊れにくさ」へ重点を移し始めたことを示している。

---

## まとめ: この論文の応用例
1. API連携AIの受け入れテスト設計。  
2. 業務オーケストレーション基盤の回帰試験強化。  
3. 監査ログを使った障害原因分析プロセスの標準化。

---

## 参考文献
1. Agent-Diff: Benchmarking LLM Agents on Enterprise API Tasks via Code Execution with State-Diff-Based Evaluation. https://arxiv.org/abs/2602.11224
