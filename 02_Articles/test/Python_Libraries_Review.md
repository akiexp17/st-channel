# 【Python流体工学】Fluidsライブラリで配管設計を完全自動化する

> [!NOTE]
> この記事は、Pythonの科学技術計算ライブラリ「Fluids」を用いて、実際のプラント配管設計（ポンプ揚程計算）をどう効率化できるかを深掘りした技術記事です。

エンジニアリングの現場では、いまだにExcelで複雑な配管抵抗計算を行っているケースが少なくありません。しかし、Excelでは「物性値の温度依存性」や「配管スケジュールの変更」に柔軟に対応できず、ミスも起きがちです。

そこで、Pythonの決定版流体ライブラリ**Fluids**を紹介します。これは、単なる計算式集ではなく、産業界で標準的に使われる膨大な工学データを内包した、まさに"エンジニアのための武器"です。

---

## Fluidsライブラリとは？
MITライセンスで公開されているオープンソースの流体工学ライブラリです。
- **網羅性**: ダルシー・ワイスバッハの式から、NASAの熱物性データ、各種バルブのCv値/K値、二相流計算までカバー。
- **実用性**: 配管サイズ（NPS/DN）、材質ごとの粗さ、継手（フィッティング）の損失係数など、実務に必要なデータベースが組み込まれています。

---

## 実践デモ: ポンプ移送システムの揚程計算

今回は、以下のシナリオで「必要なポンプのスペック」を算出するプログラムを作成します。

### シナリオ
- **プロセス**: 地上タンクから高さ15mの高架タンクへ水を移送。
- **配管**: 呼び径2インチ（50A）、Sch 40、炭素鋼管、長さ100m。
- **付属品**: エルボ4個、グローブバルブ1個。
- **流体**: 25℃の水。

### 実装コード解説
実際のコード（[deep_fluids_demo.py](./deep_fluids_demo.py)）のポイントを解説します。

#### 1. 配管スペックの自動取得
JISやANSIの配管スケジュール表を調べる必要はありません。
```python
import fluids

# 2インチ(DN50)、Schedule 40の配管情報を取得
pipe = fluids.piping.nearest_pipe(NPS=2, schedule='40')
D = pipe[1] # 内径 (約 52.5mm)
roughness = 4.5e-5 # 商業用鋼管の絶対粗さ (m)
```

#### 2. レイノルズ数と摩擦係数の計算
流速と物性値から、流れの状態（層流/乱流）を判定し、適切な摩擦係数を算出します。
```python
# レイノルズ数（Re）
Re = fluids.core.Reynolds(V, D, rho, mu)

# 摩擦係数（ダルシー・ワイスバッハ式）
# Colebrookの式などを内部で自動選択して解いてくれる
fd = fluids.friction.friction_factor(Re, eD=roughness/D)
```

#### 3. 圧力損失の積算
直管の損失（Major Loss）と、継手の損失（Minor Loss）を合計して、全揚程（Total Head）を求めます。
```python
# 直管の損失水頭
h_major = fd * (L/D) * (V**2 / (2*g))

# 継手の損失係数（K）の合計
# エルボ(x4) + 入口 + 出口 + バルブ
K_total = 4 * K_elbow + K_entrance + K_exit + K_valve

# 全損失水頭
h_dynamic = h_major + (K_total * V**2 / (2*g))
```

---

## 実行結果と考察

作成したスクリプトを実行すると、流量ごとの圧力損失（システムカーブ）が出力されました。

```text
--- System Design Parameters ---
Fluid: Water @ 25C (rho=997.04 kg/m3, mu=0.00089 Pa*s)
Pipe: NPS 2 Sch 40 (ID = 52.48 mm)
Roughness: 0.045 mm
Length: 100.0 m, Elevation: 15.0 m
------------------------------
Flow (L/min)    | Velocity (m/s)  | Re         | Friction (f) | Total Head (m) 
--------------------------------------------------------------------------------
50.0            | 0.39            | 22649      | 0.0270       | 15.47          
100.0           | 0.77            | 45299      | 0.0240       | 16.69          
150.0           | 1.16            | 67948      | 0.0227       | 18.64          
200.0           | 1.54            | 90598      | 0.0219       | 21.29          
250.0           | 1.93            | 113247     | 0.0214       | 24.65          
300.0           | 2.31            | 135897     | 0.0211       | 28.71          
--------------------------------------------------------------------------------
Design Point (200 L/min): Required Pump Head = 21.29 m
Hydraulic Power = 694.13 W
```

### 結果からわかること
1. **設計点（200 L/min）**: 必要なポンプ揚程は約 **21.3m** です。実揚程（15m）に加え、配管抵抗で約6.3mのロスが生じていることがわかります。
2. **抵抗の急増**: 流量を1.5倍（200→300 L/min）にすると、必要揚程は約7m以上（21.3→28.7m）増加します。これは圧損が流速の二乗に比例するためです。
3. **摩擦係数の変化**: 流速が上がるとRe数が増加し、摩擦係数（f）が0.027→0.021へと下がっている様子もシミュレーション通りです。

---

## まとめ: Pythonで設計するメリット

Fluidsライブラリを使うことで、以下のような「Excelでは難しいこと」が瞬時に可能になります。

- **条件変更**: 「配管径を3インチにしたら？」「流体をグリセリンに変えたら？」といったWhat-if分析が一瞬で終わります。
- **最適化**: `scipy.optimize`と組み合わせれば、「初期コスト（配管径）とランニングコスト（ポンプ動力）が最小になる最適径」を自動探索できます。
- **再現性**: 計算ロジックがコードとして残るため、誰がやっても同じ結果になり、設計根拠（Design Basis）としてそのまま提出可能です。

Pythonによるエンジニアリングは、計算自体の時間を短縮するだけでなく、**「より良い設計」を探索する時間**を生み出してくれます。

**実装コード**: [`deep_fluids_demo.py`](./deep_fluids_demo.py)
